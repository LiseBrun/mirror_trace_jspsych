<!DOCTYPE html>
<html>
    <head>
        <title>Study on Line Tracing Task | LPNC</title>

        <!-- jsPsych core library and plugins -->
      <script src="jspsych-6.3.0/jspsych.js"></script>
      <script src="jspsych-6.3.0/plugins/jspsych-html-keyboard-response.js"></script>
      <script src="jspsych-6.3.0/plugins/jspsych-image-keyboard-response.js"></script>
      <script src="jspsych-6.3.0/plugins/jspsych-preload.js"></script>
      <link href="jspsych-6.3.0/css/jspsych.css" rel="stylesheet" type="text/css">

      <!-- Line tracing task -->
      <script src="task/base64.js" type="text/javascript"></script>
      <script src="task/canvas2image.js" type="text/javascript"></script>
      <script src="task/jquery.js" type="text/javascript"></script>
      <script src="task/color_trace.js" type="text/javascript"></script>

  </head>
  <body></body>

  <script>

  /* create timeline */
      var timeline = [];

/* welcome message */
      var welcome = {
        type: "html-keyboard-response",
        stimulus: "Welcome to the experiment. Press any key to begin."
      };
      timeline.push(welcome);

/* instructions trial */
      var instructions_1 = {
          type: "html-keyboard-response",
          stimulus: `
          <p>In this task, you will have to reproduce a figure with your mouse.</p>
          <p>In each trial, you will see two rectangular panels: the drawing panel
          is at the bottom; this is where you will move the mouse cursor; the
          figure panel is at the top, this is where you will see the figure to reproduce.</p>
          <p>Press any key to begin.</p>
          `,
            };
      timeline.push(instructions_1);


      var instructions_2 = {
          type: "html-keyboard-response",
          stimulus: `
          <p>To begin a trial, move the mouse so that your cursor rests over
          the green circle in the drawing panel.</p><p>Then click the left
          mouse button to signal that you are ready to begin.</p><p> Once the
          trial begins, a red target circle appears in the mirror panel.</p>
          <p>Trace the figure working from the starting point towards the red target circle.</p>
          <p>The trial ends automatically when you reach the red circle.</p>
          <p>Press any key to begin.</p>
          `,
            };
      timeline.push(instructions_2);

/* materials */

var materials = {
		'mirror' : [false, false, false, false, false],
		'file_names' : [
			  "https://raw.githubusercontent.com/LiseBrun/mirror_trace/master/figures/s0e.png",
				"https://raw.githubusercontent.com/LiseBrun/mirror_trace/master/figures/T0h.png",
			  "https://raw.githubusercontent.com/LiseBrun/mirror_trace/master/figures/T1e.png",
				"https://raw.githubusercontent.com/LiseBrun/mirror_trace/master/figures/T1h.png",
				"https://raw.githubusercontent.com/LiseBrun/mirror_trace/master/figures/T2e.png"],

  		 			'xstarts' : [57,  326, 49, 342, 153],
  		 			'ystarts' : [146, 236, 40, 253,  51],
  		 			'xends' :   [358,  67, 340, 52, 299],
  		 			'yends' :   [146,  57, 205, 88, 176]
  		 	}

/* create variables */

//image dimensions
        	var mywidth = 393;
        	var myheight = 295;

        	var score = 0;
        	var timeDiff = 0;
        	var trialnumber = 0;
        	var MID = 0;
        	var drawing = false;
        	var finished = false;
        	var timeFinished = 0;
        	var canvas;
        	var ctx;
        	var canvas_mirror;
        	var ctx_mirror;
        	var crossings = 0;
        	var distance_total = 0;
        	var distance_current = 0;
        	var distance_inline = 0;
        	var distance_offline = 0;
        	var startTime = 0;
        	var endTime = 0;
        	var lastRefresh = 0;
        	var currentRefresh = 0;

        	// click on "enter" when they want to finish the trial
        	var press_enter = false;
        	addEventListener("keyup", function(event) {
        	 if (event.key === "Enter") {
        		 drawing = false;
        		 finished = true;
        		 //document.getElementById("status").innerHTML = "Finished with score = " + Math.round(score *100) + "%<BR> Click next to continue.";
        		 // document.getElementById("status").innerHTML = "Vous avez terminé cet essai. Cliquez sur la flèche à droite pour continuer.";
        	 }
         });


/* display canvas */

      var display_canvas = {
        type: "html-keyboard-response",
        stimulus: `
        <div id="miror_div">
        <canvas id="mirror" width="400" height="300" style="border:1px solid #000000;"></canvas>
        </div>
        <div id="sketch" >
        <canvas id="paint" width="400" height="300" style="border:1px solid #000000;"></canvas>
        </div>
        <div id="status"></div>
        <p>Press any key to begin.</p>
        `,
      };
        timeline.push(display_canvas);

/* line tracing task */

      var line_tracing_code = {function do_mirror()};

      var line_tracing = {
        type : "call-function",
        func : do_mirror
      };
        timeline.push(line_tracing);


      /* start the experiment */
      jsPsych.init({
        timeline: timeline
        });

   </script>
</html>
